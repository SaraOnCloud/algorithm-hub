<a routerLink="/algorithms" class="text-sm text-gray-600 hover:text-gray-900">‚Üê Back</a>
<ui-card title="Insertion Sort" subtitle="sorting ¬∑ easy" [hasActions]="true">
  <div class="flex flex-col gap-4">
    <!-- Toolbar -->
    <div class="flex flex-wrap items-center gap-2">
      <button class="btn btn-sm btn-primary" (click)="play()" [disabled]="running || finished">‚ñ∂ Play</button>
      <button class="btn btn-sm btn-secondary" (click)="pause()" [disabled]="!running">‚è∏ Pause</button>
      <button class="btn btn-sm btn-outline" (click)="step()" [disabled]="finished">‚è≠ Step</button>
      <button class="btn btn-sm btn-ghost" (click)="resetAlgo()">‚Üª Reset</button>

      <span class="mx-2 h-5 w-px bg-gray-300"></span>

      <label class="text-sm text-gray-700">Speed</label>
      <input type="range" min="0.25" max="2" step="0.25" [(ngModel)]="speedMultiplier" (change)="onSpeedChange()" class="w-40" />
      <span class="text-xs text-gray-600">x{{ speedMultiplier }}</span>

      <span class="mx-2 h-5 w-px bg-gray-300"></span>

      <label class="text-sm text-gray-700">Size</label>
      <input type="number" class="w-20 rounded-md border-gray-300 bg-white text-sm shadow-sm focus:border-primary-500 focus:ring-primary-500"
             [ngModel]="size" (ngModelChange)="setSize($event)" min="3" max="40" />
      <button class="btn btn-sm btn-outline" (click)="randomizeArray()">üé≤ Randomize array</button>
    </div>

    <!-- Status -->
    <div class="text-sm text-gray-700 flex items-center gap-2">
      <span class="inline-flex h-2 w-2 rounded-full" [ngClass]="{
        'bg-green-500': running,
        'animate-pulse': running,
        'bg-gray-400': !running && !finished,
        'bg-purple-500': finished
      }"></span>
      <span class="font-medium">{{ lastMessage }}</span>
      <span class="ml-auto text-xs text-gray-500">Steps {{ stepCount }} ¬∑ Comparisons {{ comparisons }} ¬∑ Shifts {{ shifts }} ¬∑ i={{ i }}</span>
    </div>

    <!-- Legend -->
    <div class="flex flex-wrap items-center gap-3 text-xs text-gray-600">
      <span class="inline-flex items-center gap-1"><span class="h-3 w-3 rounded bg-white border border-gray-300"></span> Idle</span>
      <span class="inline-flex items-center gap-1"><span class="h-3 w-3 rounded bg-accent"></span> Comparing (j)</span>
      <span class="inline-flex items-center gap-1"><span class="h-3 w-3 rounded bg-red-300 border border-red-400"></span> Shifting (j+1)</span>
      <span class="inline-flex items-center gap-1"><span class="h-3 w-3 rounded bg-green-300 border border-green-500"></span> Insert position</span>
      <span class="inline-flex items-center gap-1"><span class="h-3 w-3 rounded bg-green-200 border border-green-400"></span> Sorted prefix</span>
    </div>

    <!-- Bars visualization -->
    <div class="overflow-x-auto">
      <div class="min-w-max">
        <div class="flex items-end gap-1 h-64 p-2 border rounded-md bg-white">
          <div *ngFor="let v of arr; let idx = index" class="relative flex-1 min-w-[18px] rounded-t-md transition-all duration-300"
               [ngClass]="{
                 'bg-accent': isCompareIdx(idx) && !isShiftIdx(idx) && !isInsertIdx(idx),
                 'bg-red-300': isShiftIdx(idx),
                 'bg-green-300': isInsertIdx(idx),
                 'bg-green-200': isSortedPrefix(idx) && !isCompareIdx(idx) && !isShiftIdx(idx) && !isInsertIdx(idx),
                 'bg-gray-200': !isCompareIdx(idx) && !isShiftIdx(idx) && !isInsertIdx(idx) && !isSortedPrefix(idx)
               }"
               [style.height]="barHeight(v)">
            <!-- Value label -->
            <div class="absolute -top-6 inset-x-0 text-center text-[10px] text-gray-700">{{ v }}</div>
            <!-- Index label -->
            <div class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-[10px] text-gray-500">{{ idx }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Detailed explanation -->
    <div class="prose max-w-none">
      <h3>How Insertion Sort works</h3>
      <p>
        Insertion Sort builds the final sorted array one element at a time. For each position <em>i</em> from left to right, it takes the
        <strong>key</strong> element at <code>arr[i]</code> and inserts it into the already sorted prefix <code>arr[0..i-1]</code>, shifting larger elements to the right.
      </p>
      <h4>Pseudocode</h4>
      <pre><code>for i = 1 .. n-1:
  key = arr[i]
  j = i - 1
  while j >= 0 and arr[j] &gt; key:
    arr[j+1] = arr[j]   # shift right
    j = j - 1
  arr[j+1] = key        # insert key
</code></pre>
      <h4>Complexity</h4>
      <ul>
        <li>Best case (already sorted): O(n)</li>
        <li>Average and worst case: O(n¬≤)</li>
        <li>Space: O(1) extra (in-place)</li>
        <li>Stable: Yes (preserves equal elements order)</li>
      </ul>
      <h4>Notes</h4>
      <ul>
        <li>Good for small or nearly sorted arrays.</li>
        <li>Each pass extends the sorted prefix by one element.</li>
      </ul>
    </div>
  </div>

  <div class="card-actions flex items-center justify-end gap-2">
    <button class="btn btn-sm btn-ghost" (click)="resetAlgo()">Reset</button>
    <button class="btn btn-sm btn-primary" (click)="running ? pause() : play()">{{ running ? 'Pause' : 'Play' }}</button>
  </div>
</ui-card>
