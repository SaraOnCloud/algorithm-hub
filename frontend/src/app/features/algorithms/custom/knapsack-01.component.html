<a routerLink="/algorithms" class="inline-flex items-center gap-2 text-sm text-gray-600 hover:text-gray-900 transition-colors group">
  <span class="group-hover:-translate-x-0.5 transition-transform">‚Üê</span>
  Volver
</a>

<ui-card title="0/1 Knapsack" subtitle="dp ¬∑ medium">
  <div class="ah-knap space-y-6">
    <!-- Intro -->
    <div class="prose max-w-none">
      <p class="text-gray-600">Explora paso a paso c√≥mo la programaci√≥n din√°mica resuelve el problema de la mochila 0/1. Ajusta la capacidad, edita los √≠tems y mira c√≥mo se llena la tabla.</p>
    </div>

    <!-- Controles principales -->
    <div class="flex flex-col lg:flex-row gap-4 lg:items-end">
      <div class="flex-1 bg-white/70 dark:bg-slate-800/70 backdrop-blur rounded-xl p-4 shadow-sm border border-slate-200 dark:border-slate-700">
        <label class="flex items-center justify-between mb-2 text-sm font-medium text-slate-700 dark:text-slate-300">
          <span>Capacidad de la mochila</span>
          <span class="inline-flex items-center gap-1 text-slate-900 dark:text-white"><span class="font-semibold">{{ capacity }}</span>/<span class="text-slate-500">{{ maxCapacity }}</span></span>
        </label>
        <div class="flex items-center gap-3">
          <input type="range" class="w-full accent-cyan-500" min="0" [max]="maxCapacity" step="1" [(ngModel)]="capacity" (ngModelChange)="onCapacityChange()" />
          <input type="number" class="w-20 ah-input" min="0" [max]="maxCapacity" [(ngModel)]="capacity" (ngModelChange)="onCapacityChange()" />
        </div>
      </div>

      <div class="flex-1 bg-white/70 dark:bg-slate-800/70 backdrop-blur rounded-xl p-4 shadow-sm border border-slate-200 dark:border-slate-700">
        <label class="flex items-center justify-between mb-2 text-sm font-medium text-slate-700 dark:text-slate-300">
          <span>Velocidad</span>
          <span class="text-slate-500">{{ speed }} ms</span>
        </label>
        <div class="flex items-center gap-3">
          <input type="range" class="w-full accent-fuchsia-500" min="200" max="1500" step="50" [(ngModel)]="speed" (ngModelChange)="setSpeed($event)" />
          <select class="ah-input w-28" [(ngModel)]="speed" (ngModelChange)="setSpeed($event)">
            <option [ngValue]="300">R√°pido</option>
            <option [ngValue]="700">Normal</option>
            <option [ngValue]="1200">Lento</option>
          </select>
        </div>
      </div>

      <div class="flex-1 flex flex-wrap gap-2">
        <button (click)="toggleAutoplay()" class="ah-btn ah-btn-primary" [ngClass]="{ 'animate-pulse': autoplay }">
          <span *ngIf="!autoplay">‚ñ∂ Reproducir</span>
          <span *ngIf="autoplay">‚è∏ Pausar</span>
        </button>
        <button (click)="stepBackward()" class="ah-btn">‚ü≤ Atr√°s</button>
        <button (click)="stepForward()" class="ah-btn">‚ü∂ Paso</button>
        <button (click)="resetTables()" class="ah-btn ah-btn-soft">‚ü≤ Reiniciar</button>
        <button (click)="randomize()" class="ah-btn ah-btn-soft">üé≤ Aleatorio</button>
        <button (click)="addItem()" class="ah-btn ah-btn-outline">Ôºã A√±adir √≠tem</button>
      </div>
    </div>

    <!-- Items -->
    <div class="grid md:grid-cols-2 xl:grid-cols-3 gap-4">
      <div *ngFor="let it of items; let idx = index; trackBy: trackByIndex" class="soft-card group">
        <div class="flex items-start gap-3">
          <span class="mt-1 h-3 w-3 rounded-full ring-2 ring-offset-2 ring-offset-white dark:ring-offset-slate-900" [style.background]="it.color" [style.box-shadow]="'0 0 0 3px ' + it.color + '22'"></span>
          <div class="flex-1">
            <div class="flex items-center justify-between">
              <h3 class="font-semibold text-slate-800 dark:text-slate-100">{{ it.name }}</h3>
              <button class="text-slate-400 hover:text-rose-500 transition-colors" (click)="removeItem(idx)" aria-label="Eliminar">‚úñ</button>
            </div>
            <div class="mt-3 grid grid-cols-2 gap-3 text-sm">
              <label class="flex flex-col gap-1">
                <span class="text-slate-500">Peso</span>
                <input type="number" class="ah-input" min="1" [(ngModel)]="it.weight" (ngModelChange)="resetTables()" />
              </label>
              <label class="flex flex-col gap-1">
                <span class="text-slate-500">Valor</span>
                <input type="number" class="ah-input" min="1" [(ngModel)]="it.value" (ngModelChange)="resetTables()" />
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Visualizaci√≥n DP -->
    <div class="dp-wrap">
      <div class="flex items-center justify-between mb-2">
        <h4 class="text-sm font-semibold text-slate-700 dark:text-slate-200">Tabla de DP (filas: √≠tems, columnas: capacidad)</h4>
        <span class="text-xs text-slate-500">Celda actual: (i={{ i }}, w={{ w }})</span>
      </div>
      <div class="overflow-auto rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm">
        <table class="dp-table min-w-max">
          <thead>
            <tr>
              <th class="sticky left-0 bg-slate-50/80 dark:bg-slate-800/80 backdrop-blur z-10">i/w</th>
              <th *ngFor="let col of [].constructor(capacity + 1); let cw = index" class="text-center">{{ cw }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let r of [].constructor(items.length + 1); let ri = index">
              <th class="sticky left-0 bg-slate-50/80 dark:bg-slate-800/80 backdrop-blur z-10 text-left">
                <span *ngIf="ri === 0" class="text-slate-400">0</span>
                <span *ngIf="ri > 0">{{ items[ri - 1].name }} <span class="text-xs text-slate-400">(p={{ items[ri-1].weight }}, v={{ items[ri-1].value }})</span></span>
              </th>
              <td *ngFor="let c of [].constructor(capacity + 1); let ci = index"
                  [class.cell-current]="ri === i && ci === w && !finished"
                  [class.cell-filled]="finished || ri < i || (ri === i && ci < w)"
                  [class.cell-empty]="!(finished || ri < i || (ri === i && ci < w))"
                  class="cell">
                <ng-container *ngIf="finished || ri < i || (ri === i && ci < w); else waiting">
                  {{ dp[ri][ci] }}
                </ng-container>
                <ng-template #waiting>
                  <span class="text-slate-300">‚Äî</span>
                </ng-template>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- F√≥rmula/explicaci√≥n -->
      <div class="mt-3 text-sm text-slate-600 dark:text-slate-300 flex flex-wrap items-center gap-3">
        <div class="px-3 py-1 rounded-full bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700">
          <span class="font-mono">dp[i][w] = max(dp[i-1][w], value[i] + dp[i-1][w - weight[i]])</span>
        </div>
        <div *ngIf="i>0" class="flex items-center gap-2">
          <span class="inline-flex items-center gap-1 px-2 py-1 rounded bg-white/70 dark:bg-slate-800/70 border border-slate-200 dark:border-slate-700">
            <span class="text-slate-500">√≠tem</span>
            <span class="font-semibold" [style.color]="items[i-1].color">{{ items[i-1].name }}</span>
            <span class="text-slate-500">p={{ items[i-1].weight }}, v={{ items[i-1].value }}</span>
          </span>
          <span *ngIf="i>0 && (i-1) < items.length && items[i-1].weight <= w" class="text-emerald-600">incluible</span>
          <span *ngIf="i>0 && (i-1) < items.length && items[i-1].weight > w" class="text-rose-600">no cabe</span>
        </div>
      </div>
    </div>

    <!-- Resultado -->
    <div *ngIf="finished" class="mt-2 p-4 rounded-xl border border-emerald-300 dark:border-emerald-700 bg-emerald-50/70 dark:bg-emerald-900/20 flex items-start gap-4">
      <div class="text-2xl">‚úÖ</div>
      <div class="flex-1">
        <div class="font-semibold text-emerald-800 dark:text-emerald-300">Soluci√≥n √≥ptima encontrada</div>
        <div class="mt-1 text-sm text-emerald-700 dark:text-emerald-200">Valor m√°ximo: <span class="font-bold">{{ dp[items.length][capacity] }}</span></div>
        <div class="mt-2 flex flex-wrap gap-2">
          <span *ngFor="let idx of solution" class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 shadow-sm">
            <span class="h-2 w-2 rounded-full" [style.background]="items[idx].color"></span>
            <span class="text-sm">{{ items[idx].name }}</span>
            <span class="text-xs text-slate-500">(p={{ items[idx].weight }}, v={{ items[idx].value }})</span>
          </span>
        </div>
      </div>
    </div>
  </div>
</ui-card>
